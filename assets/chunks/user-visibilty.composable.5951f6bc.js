var v=Object.defineProperty;var f=(t,e,i)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var s=(t,e,i)=>(f(t,typeof e!="symbol"?e+"":e,i),i);import{h as a,l as m}from"./framework.e7ad9e79.js";function n(){return typeof document<"u"}class g{constructor(e,i){s(this,"defaultOptions",{element:void 0,timeout:60*1e3*5,once:!1,immediate:!0,ssr:!1});s(this,"options");s(this,"timeoutHandler");s(this,"isIdle",!1);s(this,"isDestroy",!1);s(this,"startTime",0);s(this,"remainingTime",0);s(this,"lastClientX",-1);s(this,"lastClientY",-1);s(this,"eventNames",["DOMMouseScroll","mousedown","mousemove","mousewheel","MSPointerDown","MSPointerMove","keydown","touchmove","touchstart","wheel","click"]);s(this,"handleEvent",e=>{try{if(this.remainingTime>0)return;if(e.type==="mousemove"){const{clientX:i,clientY:o}=e;if(i===void 0&&o===void 0||i===this.lastClientX&&o===this.lastClientY)return;this.lastClientX=i,this.lastClientY=o}this.resetTimeout(),this.callback({isIdle:this.isIdle,eventType:e.type})}catch(i){throw new Error(`[IdleTimeout](handleEvent) ${i}`)}});this.callback=e,this.options={...this.defaultOptions,...i},!this.options.ssr&&n()?this.start():!this.options.ssr&&!n()&&console.warn('[IdleTimeout](constructor) executed on server side - set immediate option to "false"')}get element(){return this.options.element??document.body}start(){if(!n()){console.warn("[IdleTimeout](start) you should run this method on client side");return}for(const e of this.eventNames)this.element.addEventListener(e,this.handleEvent);this.resetTimeout(),this.options.immediate&&this.callback({isIdle:!1})}pause(){const e=this.startTime+this.options.timeout-Date.now();e<=0||(this.remainingTime=e,this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0))}resume(){this.remainingTime<=0||(this.resetTimeout(),this.callback({isIdle:this.isIdle}),this.remainingTime=0)}reset(){this.isDestroy=!1,this.isIdle=!1,this.remainingTime=0,this.resetTimeout(),this.callback({isIdle:this.isIdle})}destroy(){if(!n()){console.warn("[IdleTimeout](destroy) you should run this method on client side");return}this.isDestroy=!0;for(const e of this.eventNames)this.element.removeEventListener(e,this.handleEvent);this.timeoutHandler&&clearTimeout(this.timeoutHandler)}resetTimeout(){this.isIdle=!1,this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0),this.timeoutHandler=setTimeout(this.handleTimeout.bind(this),this.remainingTime||this.options.timeout),this.startTime=Date.now()}handleTimeout(){this.isIdle=!0,this.callback({isIdle:this.isIdle}),this.options.once&&this.destroy()}get destroyed(){return this.isDestroy}get timeout(){return this.options.timeout}set timeout(e){this.options.timeout=e}get idle(){return this.isIdle}set idle(e){e?this.handleTimeout():this.reset(),this.callback({isIdle:this.isIdle})}}class y{constructor(e,i){s(this,"eventHandlerFunction");s(this,"event","visibilitychange");s(this,"timeoutHandler");s(this,"options");s(this,"defaultOptions",{timeout:5e3,once:!1,immediate:!0,ssr:!1});s(this,"isVisible",!1);this.callback=e,this.options={...this.defaultOptions,...i},this.eventHandlerFunction=this.eventHandler.bind(this),!this.options.ssr&&n()?this.start():!this.options.ssr&&!n()&&console.warn('[UserVisibility](constructor) executed on server side - set "ssr" option to "false"')}start(){if(!n()){console.warn("[UserVisibility](start) you should run this method on client side");return}this.options.immediate&&this.emitCallback(),this.addEventListener()}emitCallback(){this.isVisible=document.visibilityState==="visible",this.callback({isVisible:this.isVisible}),this.options.once&&this.destroy()}eventHandler(){document.visibilityState==="visible"&&!this.isVisible?(this.clearTimeout(),this.emitCallback()):document.visibilityState==="hidden"&&this.initTimeout()}clearTimeout(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)}initTimeout(){this.clearTimeout(),this.timeoutHandler=setTimeout(this.emitCallback.bind(this),this.options.timeout)}addEventListener(){document.addEventListener(this.event,this.eventHandlerFunction)}removeEventListener(){document.removeEventListener(this.event,this.eventHandlerFunction)}destroy(){this.removeEventListener(),this.timeoutHandler&&clearTimeout(this.timeoutHandler)}}const u={darkClass:"dark",storageThemeKey:"theme",storageThemeValueDark:"dark",storageThemeValueLight:"light"},l=a(),r=({darkClass:t,storageThemeKey:e,storageThemeValueDark:i,setLocalStorageValue:o=!0})=>{document.documentElement.classList.add(t),l.value=i,o&&(localStorage[e]=i)},h=({darkClass:t,storageThemeKey:e,storageThemeValueLight:i,setLocalStorageValue:o=!0})=>{document.documentElement.classList.remove(t),l.value=i,o&&(localStorage[e]=i)},b=t=>{localStorage[t.storageThemeKey]===t.storageThemeValueDark||!(t.storageThemeKey in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?r({...t,setLocalStorageValue:!1}):h({...t,setLocalStorageValue:!1})},d=({shouldSetDarkMode:t,...e})=>t?r(e):h(e),p=t=>localStorage[t.storageThemeKey]===t.storageThemeValueDark?h(t):r(t),I=(t=u)=>{const e={...u,...t},i=m(()=>l.value===e.storageThemeValueDark),o=m(()=>l.value===e.storageThemeValueLight);return{autoSetTheme:()=>b(e),toggleTheme:()=>p(e),setDarkTheme:()=>d({...e,shouldSetDarkMode:!0}),setLightTheme:()=>d({...e,shouldSetDarkMode:!1}),hasDarkTheme:i,hasLightTheme:o,theme:l}},c=a(),w=({callback:t,options:e})=>{const i=new g(t,e);return c.value=i,{idle:c}},T=a(),S=({callback:t,options:e})=>{const i=new y(t,e);return T.value=i,{visibility:T}};export{I as a,S as b,n as i,w as u};
